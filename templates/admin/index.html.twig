{% extends 'base.html.twig' %}

{% block title %}Hello AdminController!{% endblock %}

{% block main %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

        <div class="form-wrapper">       
                {{ form_start(form) }}
                <div class="form-group  pb-2 pt-4">
                {{ form_row(form.startTime, {'label':'Mon titre' })}}
                </div>
                <div class="form-group  pb-2 pt-4">
                {{ form_row(form.endTime, {'label':'Mon titre' })}}
                </div>
                <div class="form-group  pb-2 pt-4">
                {{ form_row(form.appointmentDay, {'label':'Mon titre' })}}
                </div>  
                <div class="form-group  pb-2 pt-4">
                {{ form_row(form.idDepartment)}}
                </div> 
                <div class="form-group  pb-2 pt-4"> 
                {{ form_row(form.submit, { 'label': 'Submit article!' })}}
                </div>  
                <div class="form-group  pb-2 pt-4">
                {{ form_row(form.idDoctor)}}
                </div> 
                {{ form_end(form) }}
        </div> 
           
         
{% endblock %}
{% block javascripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $("#appointment_form_idDepartment").on("change", function () {
        let $field = $(this)
        let $departmentField = $('#appointment_form_idDepartment')
        let $startTimeHourField = $('#appointment_form_startTime_hour')
        let $startTimeMinField = $('#appointment_form_startTime_minute')
        let $endTimeHourField = $('#appointment_form_endTime_hour')
        let $endTimeMinField = $('#appointment_form_endTime_minute')
        let $rdvDayMonthField = $('#appointment_form_appointmentDay_month')
        let $rdvDayDayField = $('#appointment_form_appointmentDay_day')
        let $rdvDayYearField = $('#appointment_form_appointmentDay_year')
        let $form = $field.closest('form')
        let target = '#' + $field.attr('id').replace('departement', 'ville').replace('region', 'departement')
        // Les données à envoyer en Ajax 
        let data = {}
        data[$departmentField.attr('name')] = $departmentField.val() 
        data[$startTimeHourField.attr('name')] = $startTimeHourField.val()
        data[$startTimeMinField.attr('name')] = $startTimeMinField.val() 
        data[$endTimeHourField.attr('name')] = $endTimeHourField.val() 
        data[$endTimeMinField.attr('name')] = $endTimeMinField.val() 
        data[$rdvDayMonthField.attr('name')] = $rdvDayMonthField.val() 
        data[$rdvDayDayField.attr('name')] = $rdvDayDayField.val() 
        data[$rdvDayYearField.attr('name')] = $rdvDayYearField.val() 

        //data[$field.attr('name')] = $field.val()
        // On soumet les données
        $.post($form.attr('action'), data).then(function (data) {
            // On récupère le nouveau <select>
            let $input = $(data).find('#appointment_form_idDoctor')
            // On remplace notre <select> actuel
            $("#appointment_form_idDoctor").replaceWith($input)
        })
        })
</script>
{% endblock %}